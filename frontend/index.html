<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HSL Editor</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    img { max-width: 500px; display: block; margin-top: 20px; }
    .slider { margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Photo HSL Editor</h1>

  <!-- Upload -->
  <input type="file" id="fileInput" />
  <button onclick="uploadImage()">Upload</button>

  <!-- Sliders -->
  <div class="slider">
    <label>Hue Shift: <span id="hueVal">0</span></label>
    <input type="range" id="hue" min="-180" max="180" value="0" step="1" />
  </div>
  <div class="slider">
    <label>Saturation Scale: <span id="satVal">1</span></label>
    <input type="range" id="sat" min="0" max="2" value="1" step="0.1" />
  </div>
  <div class="slider">
    <label>Lightness Scale: <span id="lightVal">1</span></label>
    <input type="range" id="light" min="0" max="2" value="1" step="0.1" />
  </div>

  <!-- Preview -->
  <img id="preview" src="" alt="Preview will appear here" />

  <script>
    let filename = null;

    async function uploadImage() {
      const file = document.getElementById("fileInput").files[0];
      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch("/upload", {
        method: "POST",
        body: formData,
      });
      console.log('----res', res)
      const data = await res.json();
      filename = data.filename;
      updateImage();
    }

    async function updateImage() {
      if (!filename) return;

      const hue = document.getElementById("hue").value;
      const sat = document.getElementById("sat").value;
      const light = document.getElementById("light").value;

      // Update labels
      document.getElementById("hueVal").innerText = hue;
      document.getElementById("satVal").innerText = sat;
      document.getElementById("lightVal").innerText = light;

      const formData = new FormData();
      formData.append("hue_shift", hue);
      formData.append("sat_scale", sat);
      formData.append("light_scale", light);

      const res = await fetch("/adjust", {
        method: "POST",
        body: formData,
      });

      if (res.ok) {
        document.getElementById("preview").src = URL.createObjectURL(await res.blob());
      }
    }

    var hue = document.getElementById("hue")
    hue.addEventListener("change", () => {
      updateImage();
    });

    var sat = document.getElementById("sat");
    sat.addEventListener("change", () => {
      updateImage();
    });

    var light = document.getElementById("light");
    light.addEventListener("change", () => {
      updateImage();
    });

    // Bind sliders to update
    // document.getElementById("hue").addEventListener("input", updateImage);
    // document.getElementById("sat").addEventListener("input", updateImage);
    // document.getElementById("light").addEventListener("input", updateImage);
  </script>
</body>
</html>
